# SQL注入

## 漏洞原理

攻击者注入恶意SQL语句，拼接到后端成功执行。

## 漏洞测试

1. 输入单引号、双引号或括号等闭合

   

2. 常用测试payload

   ```
   https://github.com/payloadbox/sql-injection-payload-list
   ```

3. 在存在数据交互的链接参数测试

## 测试工具

1. Burpsuite

   - 使用intruder功能 自带SQL注入爆破字典，可探测注入点

2. sqlmap

   可联动CO2插件

   ```
   使用手册
   https://sqlmap.kvko.live/usage
   
   常用命令
   python sqlmap.py -u http://xxx.xom --random-agent --cookie=COOKIE --batch -v 3 --delay 2
   
   从http请求探测
   -r
   
   测试指定参数 加*
   python sqlmap.py -u "http://targeturl/param1/value1*/param2/value2/"
   
   指纹识别
   默认识别指纹，如果想更准确识别开启下列参数
   -f 或 --fingerprint
   
   并发
   --threads
   
   使用技巧
   - 没检测到问题时可提升level等级探测尝试一下
   ```

## 漏洞防御

- WAF

- 预编译

  这种形式是预先确定了SQL的语法格式，用户输入不能改变后端SQL语法


# 身份验证漏洞

## 漏洞原理

> 身份验证和授权的区别：一个是验证身份，另一个是被允许做某事。

1. 身份验证机制弱，无法防止爆破
2. 代码逻辑存在问题，可绕过

## 漏洞测试

1. 基于密码登录

   - 同时爆破用户名密码

   - 固定密码爆破用户名或固定用户名爆破密码

   - 用户名枚举

     [靶场练习1](https://portswigger.net/web-security/authentication/password-based)

     [靶场练习2](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-response-timing)

     - 检查验证码、错误消息、响应时间差异

     - 相应差异这里有时候一个符号的差异也可能有收获
     - 如果大多数请求都以相似的响应时间处理，那么任何偏离此时间的请求都表明幕后正在发生不同的事情。这是猜测的用户名可能是正确的另一个迹象；例如，网站可能仅在用户名有效时才检查密码是否正确。这个额外的步骤可能会导致响应时间略有增加。这种差异可能很小，但攻击者可以通过输入一个过长的密码来使这种延迟更加明显，该网站需要明显更长的时间来处理。

2. 多因素身份认证

   > 例如带验证码

   - 当口令输入和验证码输入不在一个页面

     尝试用自己账户或已知账户登录，记录登录后的URL，然后切换其他用户，在跳转验证码页面时候，修改URL。这种情况是后端在没确认验证码就认为用户已经登录

   - 测试验证码是否可以绕过

   - [爆破验证码](https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-broken-logic)

3. 绕过限制

   > 根据目标限制策略制定爆破方式

   - 限制失败次数阻止IP，若登录成功则重置计数

     可结合已知用户口令，添加到字典，实现在限定次数内正确登录一次，绕过限制。

   - 存在逻辑缺陷的锁IP

     这种在一定次数爆破后，报错信息可能出现差异，从而爆破出用户名

     [靶场](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-account-lock)

   - JSON 请求，一次填充多个口令

     [靶场](https://portswigger.net/web-security/authentication/password-based/lab-broken-brute-force-protection-multiple-credentials-per-request)

4. 分析逻辑，考虑多种可能性

## 测试工具

- Burpsuite

# 目录遍历

## 漏洞原理

加载文件内容功能的链接没有过滤，或者文件名后台没有进行标准化处理过滤，攻击者可以拼接系统绝对路径或上层目录方式读取任意文件。

## 漏洞测试

1. 在读取文件内容或加载文件的参数后添加payload

   ```
   ../../ect/passwd
   直接添加绝对路径：/etc/passwd
   ```

2. 在web页面图片右键新链接打开，更改文件名为payload

3. 绕过限制

   - 双写怕payload
   - URL编码或双重URL编码
   - 给定文件目录后添加payload
   - 后缀名前%00截断

## 测试工具

- Burpsuite自带fuzz 目录遍历字典，或使用自己的字典，包含常规测试payload。
- 爆破位置：文件名处、后缀前、指定目录文件名后边

## 漏洞防御

1. 白名单过滤
2. 后台使用路径规范化函数过滤



